<div class="page-container">
    <ng-container *ngIf="!loading; else loadingDiv">
        <ng-container *ngIf="characterData.length; else noCharacters">
            <div class="page-actions">
                <button mat-icon-button (click)="refresh()" aria-label="Refresh All">
                    <mat-icon>refresh</mat-icon>
                </button>
            </div>
    
            <div class="characters">
                <div *ngFor="let result of characterData" class="character">
                    <ng-container *ngIf="!result.error">
                        <span class="cc-icon" [style.background-image]="result?.media?.avatar_url | safeBackgroundImage"></span>
                        <span class="cc cc-{{ result?.profile?.character_class.id }}">{{ result.info.name }}</span>
                        <span class="progress-bar">
                            <ng-container  *ngIf="!result.loading; else loadingDivSmall">
                                <span class="progress-level" [style.width]="((result.profile.level / MAX_LEVEL) * 100) + '%'"></span>
                                <span class="heart-level" [style.width]="(((result.equipment.equipped_items | hoaLevel) / MAX_HEART_LEVEL) * 100) + '%'"></span>
                                <span class="progress-name">
                                    <span *ngIf="result.profile.level < MAX_LEVEL">Level {{ result.profile.level }}</span>
                                    <span *ngIf="result.profile.level == MAX_LEVEL">Heart Level {{ result.equipment.equipped_items | hoaLevel }}</span>
                                </span>
                            </ng-container>
                        </span>        
                        <span class="actions">
                            <button mat-icon-button [routerLink]="[ '/', result.info.region, result.info.realm, result.info.name, 'checklist' ]">
                                <mat-icon>playlist_add_check</mat-icon>
                            </button>
                        </span>
                    </ng-container>
                    <div *ngIf="!result.loading && result.error">
                        There was an error loading this character. Ensure that it exists and you have logged in recently.
                    </div>
                    <!-- <ng-container *ngIf="result.loading; then loadingDiv"></ng-container> -->
                </div>
            </div>
        </ng-container>
    </ng-container>
</div>

<ng-template #loadingDiv>
    <div class="centered">
        <mat-spinner diameter="30" color="accent"></mat-spinner>
    </div>
</ng-template>
<ng-template #loadingDivSmall>
    <div class="centered">
        <mat-spinner diameter="10" color="accent"></mat-spinner>
    </div>
</ng-template>
<ng-template #noCharacters>
    <div class="card-container">
        <mat-card>
            <mat-card-header>
                <mat-card-title>No characters set up!</mat-card-title>
            </mat-card-header>
            <mat-card-actions>
                <button mat-button color="accent" (click)="setupTestData()">Add Test Data</button>
            </mat-card-actions>
        </mat-card>
    </div>
</ng-template>